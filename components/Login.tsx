
import React, { useState } from 'react';
import { User, UserRole } from '../types';
import { Lock, User as UserIcon, LogIn, GraduationCap, BookOpen, Shield, Info, Database } from 'lucide-react';

interface LoginProps {
  users: User[];
  onLogin: (user: User) => void;
}

const Login: React.FC<LoginProps> = ({ users, onLogin }) => {
  const [activeRole, setActiveRole] = useState<UserRole>('student');
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    setError('');

    const user = users.find(u => u.username === username && u.password === password);
    
    if (user) {
      if (user.role === activeRole) {
        onLogin(user);
      } else {
        const roleNames = { student: 'Student', teacher: 'Teacher', headmaster: 'Headmaster' };
        setError(`Access Denied: You cannot log in here. Please use the ${roleNames[user.role]} portal.`);
      }
    } else {
      setError('Invalid username or password');
    }
  };

  const handleRoleSwitch = (role: UserRole) => {
      setActiveRole(role);
      setError('');
      setUsername('');
      setPassword('');
  };

  return (
    <div className="min-h-screen bg-slate-100 flex items-center justify-center p-4">
      <div className="bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden animate-in fade-in zoom-in duration-300">
        
        {/* Role Selection Header */}
        <div className="bg-slate-50 border-b border-slate-100 p-2">
            <div className="grid grid-cols-3 gap-2">
                <button 
                    onClick={() => handleRoleSwitch('student')}
                    className={`flex flex-col items-center justify-center py-3 rounded-xl transition-all ${activeRole === 'student' ? 'bg-white shadow-md text-emerald-600 ring-1 ring-slate-200' : 'text-slate-400 hover:bg-slate-100'}`}
                >
                    <GraduationCap size={20} className="mb-1" />
                    <span className="text-xs font-bold">Student</span>
                </button>
                <button 
                    onClick={() => handleRoleSwitch('teacher')}
                    className={`flex flex-col items-center justify-center py-3 rounded-xl transition-all ${activeRole === 'teacher' ? 'bg-white shadow-md text-indigo-600 ring-1 ring-slate-200' : 'text-slate-400 hover:bg-slate-100'}`}
                >
                    <BookOpen size={20} className="mb-1" />
                    <span className="text-xs font-bold">Teacher</span>
                </button>
                <button 
                    onClick={() => handleRoleSwitch('headmaster')}
                    className={`flex flex-col items-center justify-center py-3 rounded-xl transition-all ${activeRole === 'headmaster' ? 'bg-white shadow-md text-purple-600 ring-1 ring-slate-200' : 'text-slate-400 hover:bg-slate-100'}`}
                >
                    <Shield size={20} className="mb-1" />
                    <span className="text-xs font-bold">Admin</span>
                </button>
            </div>
        </div>

        <div className="p-8">
            <div className="text-center mb-8">
            <h1 className="text-2xl font-black text-slate-900 mb-1">
                Indrayani School
            </h1>
            <p className="text-slate-500 text-sm font-bold uppercase tracking-wider">
                {activeRole === 'student' && 'Student Portal'}
                {activeRole === 'teacher' && 'Staff Login'}
                {activeRole === 'headmaster' && 'Headmaster Login'}
            </p>
            </div>

            <form onSubmit={handleSubmit} className="space-y-6">
            <div>
                <label className="block text-xs font-bold text-slate-600 uppercase mb-2 ml-1">Username</label>
                <div className="relative">
                <UserIcon className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" size={18} />
                <input
                    type="text"
                    value={username}
                    onChange={(e) => setUsername(e.target.value)}
                    className="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-4 focus:ring-indigo-500/5 focus:border-indigo-500 transition-all font-medium text-slate-800 outline-none"
                    placeholder="Enter your username"
                    required
                />
                </div>
            </div>

            <div>
                <label className="block text-xs font-bold text-slate-600 uppercase mb-2 ml-1">Password</label>
                <div className="relative">
                <Lock className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" size={18} />
                <input
                    type="password"
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                    className="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-4 focus:ring-indigo-500/5 focus:border-indigo-500 transition-all font-medium text-slate-800 outline-none"
                    placeholder="Enter your password"
                    required
                />
                </div>
            </div>

            {error && (
                <div className="text-rose-600 text-sm font-medium text-center bg-rose-50 py-3 rounded-lg border border-rose-100 px-4 leading-tight animate-in fade-in slide-in-from-top-1">
                {error}
                </div>
            )}

            <button
                type="submit"
                className={`w-full text-white font-bold py-3.5 rounded-xl hover:opacity-90 transition-all transform active:scale-95 flex items-center justify-center gap-2 shadow-lg 
                    ${activeRole === 'student' ? 'bg-emerald-600 shadow-emerald-200' : ''}
                    ${activeRole === 'teacher' ? 'bg-indigo-600 shadow-indigo-200' : ''}
                    ${activeRole === 'headmaster' ? 'bg-purple-600 shadow-purple-200' : ''}
                `}
            >
                <LogIn size={20} />
                Secure Login
            </button>
            </form>

            <div className="mt-8 pt-6 border-t border-slate-100 space-y-4">
                <div className="p-4 bg-indigo-50 rounded-xl border border-indigo-100 flex items-start gap-3">
                    <Database size={18} className="text-indigo-500 mt-0.5 shrink-0" />
                    <div>
                      <p className="text-[10px] text-indigo-700 font-black uppercase leading-relaxed tracking-wider mb-1">
                        Device Portability Note
                      </p>
                      <p className="text-[10px] text-indigo-600 font-medium leading-relaxed">
                        Data is stored locally in this browser. To log in on a different device, your Headmaster must transfer the database via the "System" module.
                      </p>
                    </div>
                </div>
                <div className="p-4 bg-slate-50 rounded-xl border border-slate-100 flex items-start gap-3">
                    <Info size={16} className="text-slate-400 mt-0.5 shrink-0" />
                    <p className="text-[10px] text-slate-400 font-bold uppercase leading-relaxed tracking-wider">
                        Please use the credentials provided by the school administration office to access your account.
                    </p>
                </div>
            </div>

            <div className="mt-8 text-center text-[10px] text-slate-300 font-black tracking-widest uppercase">
            © 2025 Indrayani School • Private System
            </div>
        </div>
      </div>
    </div>
  );
};

export default Login;
